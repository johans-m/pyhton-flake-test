name: Django Code Standards

on:
  push:
    branches:
      - main

jobs:
  lint:
    runs-on: ubuntu-latest
    name: Check Python/Django Code Standards

    steps:
      # 1. Checkout del c√≥digo
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2. Configurar Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      # 3. Instalar dependencias del proyecto y linters
      - name: Install dependencies and linters
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          fi
          pip install flake8 black

      # 4. Obtener archivos Python modificados
      - name: Get changed Python files
        id: changed-files
        uses: tj-actions/changed-files@v41
        with:
          files: |
            **.py

      # 5. Ejecutar linters en archivos modificados
      - name: Run linters on changed files
        if: steps.changed-files.outputs.all_changed_files != ''
        run: |
          echo "Running flake8 and black on changed Python files..."
          for FILE in ${{ steps.changed-files.outputs.all_changed_files }}; do
            echo "--------------------------------------------"
            echo "File: $FILE"
            flake8 "$FILE" || echo "Hint: Run 'flake8 $FILE' to see errors"
            black --check "$FILE" || echo "Hint: Run 'black $FILE' to format the code"
            echo ""
          done

      # 6. Resumen
      - name: Report results
        run: echo "Linting complete. Check above for hints per file."
